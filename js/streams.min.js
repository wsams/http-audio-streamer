function toggleMusicOn(a){0<$(".m3uplayer").length&&a==$("#theurl").data("url")?0<$(".jp-playlist ul li").length&&("Play"==$("#playbutton").html()?($(".jp-play").click(),$("#playbutton").html("Pause")):($(".jp-pause").click(),$("#playbutton").html("Play"))):createPlaylistJs(a)}
function createPlaylistJs(a){isRadioMode=!1;displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=createPlaylistJs&dir="+encodeURIComponent(a),success:function(a){var c=$("#content").width();$("#content-player").html(a);isMobile&&isMobile()&&($("#musicindex").remove(),$("#playercontrols").remove(),a=c-16,$("#mediaplayer_wrapper").css("width",a+"px"));hideWorking()}})}function openMyRadio(){location.hash="#/myradio"}
function doOpenMyRadio(){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=openMyRadio",success:function(a){handleLogoutHtml(a);var b=$("#playercontrols");0<b.size()&&b.remove();$("#musicwrapper").html(a);hideWorking()}})}
function getHomeNavigation(){1>$("#navlist .previousDirectoryListItem .filesize_type .dirlink").size()&&(displayWorking(),$.ajax({type:"GET",url:"ajax.php",data:"action=getHomeNavigation",success:function(a){handleLogoutHtml(a);$("#navlist").html(a);hideWorking()}}))}function openDir(a){location.hash="#/open/"+encodeURIComponent(a)}
function doOpenDir(a){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=openDir&url="+encodeURIComponent(a)+"&dir="+encodeURIComponent(a),success:function(a){handleLogoutHtml(a);/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?JSON.parse(a).is_logged_in&&$("#content").html(a):($("#content").html(a),$("html").scrollTop());hideWorking()}})}
function init(){var a=window.location.hash,a=a.replace(/^#/,""),a=a.split("/");switch(a[1]){case "open":a=decodeURIComponent(a[2]);doOpenDir(a);break;case "myradio":getHomeNavigation();doOpenMyRadio();break;case "viewstations":getHomeNavigation();doViewMyRadio();break;case "loadstation":getHomeNavigation(),a=decodeURIComponent(a[2]),doLoadRadio(a)}}
function search(a){if(3>a.length)return getHomeIndex();0<$("#playbutton").length&&$("#playbutton").parent().remove();displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=search&q="+encodeURIComponent(a),success:function(a){handleLogoutHtml(a);1>$("#musicindex").size()&&$("#musicwrapper").prepend('<ul id="musicindex"></ul>');$("#musicindex").html(a);hideWorking()}})}
function getHomeIndex(){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=getHomeIndex",success:function(a){handleLogoutHtml(a);$("#navlist").html(a);$("#musicindex").html(a);hideWorking()}})}function displayWorkingMsg(){}function displayWorking(){$("#loading").css("display","block").css("visibility","visible")}function hideWorking(){$("#loading").css("display","none").css("visibility","hidden")}
function clearPlaylist(){$.getJSON("ajax.php?action=clearPlaylist",function(){myPlaylist.remove()})}
function addToPlaylist(a,b){var c=a||window.event;displayWorking();var d=$(b).data("type"),e="";"dir"==d?e="addToPlaylist":"file"==d&&(e="addToPlaylistFile");$.getJSON("ajax.php?action="+e+"&dir="+encodeURIComponent($(b).data("dir"))+"&file="+encodeURIComponent($(b).data("file")),function(a){handleLogoutJson(a);$(a).each(function(a,b){myPlaylist.add(b)});$(".album-title").text("Custom playlist");hideWorking()});c.stopPropagation();c.stopImmediatePropagation();c.cancelBubble=!0;return!1}
function logout(){displayWorking();$.ajax({type:"GET",url:"ajax.php",data:"action=logout",success:function(){hideWorking();location.href="index.php"}})}function isJson(a){return!a.match(/^\s*{/)||!a.match(/^\s*\[/)||a.match(/^\s*$/)?!1:!0}function handleLogoutHtml(a){if(!isJson(a))return!1;a=JSON.parse(a);handleLogoutJson(a)}function handleLogoutJson(a){if(void 0===a.is_logged_in)return!1;a.is_logged_in||logout()}
function playRadio(){isRadioMode=!0;displayWorking();var a=new StreamsConfig;$.ajax({type:"GET",url:"ajax.php",data:"action=playRadio&num="+a.numberOfRadioItems,success:function(a){handleLogoutHtml(a);var c=$("#content").width();$("#content-player").html(a);$(".album-title").text("Radio");$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),$("#playercontrols").remove(),a=c-16,$("#mediaplayer_wrapper").css("width",a+"px"),a=$("#mediaplayer").offset().top,window.scrollTo(0,a));$("#mediaplayer").bind($.jPlayer.event.play,
function(){console.log("bind1: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current);myPlaylist.playlist.length===myPlaylist.current+1&&$.getJSON("ajax.php?action=getRandomPlaylist&num=1",function(a){$(a).each(function(a,b){myPlaylist.add(b)})})}).bind($.jPlayer.event.ended,function(){myPlaylist.remove(myPlaylist.current-1);$.getJSON("ajax.php?action=getRandomPlaylist&num=1",function(a){$(a).each(function(a,b){myPlaylist.add(b)})})});hideWorking()}})}
currentMyRadioStation=null;
function playMyRadio(a){currentMyRadioStation=a;isRadioMode=!0;displayWorking();var b=new StreamsConfig;$.getJSON("ajax.php?action=startPersonalRadio&num="+b.numberOfRadioItems+"&station="+encodeURIComponent(a),function(b){handleLogoutJson(b);var d=$("#content").width();$("#content-player").html(b.contentPlayer);null===a||void 0===a||"null"===a||"undefined"===a?$(".album-title").html("My Radio"):$(".album-title").html(a.replace(/_/," "));$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),
$("#playercontrols").remove(),b=d-16,$("#mediaplayer_wrapper").css("width",b+"px"),b=$("#mediaplayer").offset().top,window.scrollTo(0,b));$("#mediaplayer").bind($.jPlayer.event.play,function(){console.log("bind2: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current);if(myPlaylist.playlist.length===myPlaylist.current+1){var a="";null!=currentMyRadioStation&&(a="&station="+currentMyRadioStation);$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes"+a,function(a){$(a).each(function(a,
b){myPlaylist.add(b)})})}}).bind($.jPlayer.event.ended,function(){console.log("Music has ended, changing tracks.");myPlaylist.remove(myPlaylist.current-1);var a="";null!=currentMyRadioStation&&(a="&station="+currentMyRadioStation);$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes"+a,function(a){$(a).each(function(a,b){myPlaylist.add(b)})})});hideWorking()})}
function createPersonalRadio(a,b){var c=a||window.event;isRadioMode=!0;displayWorking();var d=$(b).data("dir"),e=new StreamsConfig;$.getJSON("ajax.php?action=createPersonalRadio&dir="+encodeURIComponent(d)+"&num="+e.numberOfRadioItems,function(a){handleLogoutJson(a);var b=$("#content").width();$("#content-player").html(a.contentPlayer);$(".album-title").text("Radio "+d);$("#playbutton").remove();isMobile&&isMobile()&&($("#musicindex"),$("#playercontrols").remove(),a=b-16,$("#mediaplayer_wrapper").css("width",
a+"px"),a=$("#mediaplayer").offset().top,window.scrollTo(0,a));$("#mediaplayer").bind($.jPlayer.event.play,function(){console.log("bind3: Playlist size: "+myPlaylist.playlist.length+", Current position: "+myPlaylist.current);myPlaylist.playlist.length===myPlaylist.current+1&&$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes",function(a){$(a).each(function(a,b){myPlaylist.add(b)})})}).bind($.jPlayer.event.ended,function(){myPlaylist.remove(myPlaylist.current-1);$.getJSON("ajax.php?action=getRandomPlaylist&num=1&personal=yes",
function(a){$(a).each(function(a,b){myPlaylist.add(b)})})});hideWorking()});c.stopPropagation();c.stopImmediatePropagation();c.cancelBubble=!0;return!1}
function removeFromPersonalRadio(a,b){var c=a||window.event;displayWorking();var d=$(b).data("dir"),e=window.location.hash,e=e.replace(/^#/,""),e=e.split("/"),f="";switch(e[1]){case "loadstation":f=decodeURIComponent(e[2])}$.getJSON("ajax.php?action=removeFromPersonalRadio&dir="+encodeURIComponent(d)+"&station="+encodeURIComponent(f),function(a){handleLogoutJson(a);var c=window.location.hash,c=c.replace(/^#/,"");switch(c.split("/")[1]){case "myradio":$(b).parent().parent().parent().parent().remove();
case "loadstation":$(b).parent().parent().parent().parent().remove();default:$(b).parent().replaceWith(a.button)}hideWorking()});c.stopPropagation();c.stopImmediatePropagation();c.cancelBubble=!0;return!1}
function addToPersonalRadio(a,b){var c=a||window.event;displayWorking();var d=$(b).data("dir");$.getJSON("ajax.php?action=addToPersonalRadio&dir="+encodeURIComponent(d),function(a){$(b).parent().replaceWith(a.button);handleLogoutJson(a);hideWorking()});c.stopPropagation();c.stopImmediatePropagation();c.cancelBubble=!0;return!1}pt=null;
function playTimeout(){clearTimeout(pt);$(".jp-pause").click();$("#playbutton").html("Play");confirm("Are you still listening?")&&($(".jp-play").click(),$("#playbutton").html("Pause"),setPlayTimeout());return!1}function setPlayTimeout(){var a=new StreamsConfig;if(!a.usePlayTimeout)return!1;pt=setTimeout("playTimeout()",1E3*parseInt(a.playTimeout))}function clickSaveMyRadio(){saveDialog?hideSaveRadioDialog():showSaveRadioDialog()}
function showSaveRadioDialog(){var a=$("#save-radio-dialog");saveDialog=!0;a.css("visibility","visible").css("display","block")}function hideSaveRadioDialog(){var a=$("#save-radio-dialog");saveDialog=!1;a.css("visibility","hidden").css("display","none")}
function saveMyRadio(){var a=$("#save-radio-name").val();displayWorking();$.getJSON("ajax.php?action=saveMyRadio&name="+encodeURIComponent(a),function(a){"ok"===a.status?hideSaveRadioDialog():"error"===a.status?alert(a.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(a);hideWorking()})}function viewMyRadio(){location.hash="#/viewstations"}
function doViewMyRadio(){displayWorking();$.getJSON("ajax.php?action=viewMyRadio",function(a){"ok"===a.status?$("#musicwrapper").html(a.html):"error"===a.status?alert(a.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(a);hideWorking()})}function loadRadio(a){location.hash="#/loadstation/"+a}
function doLoadRadio(a){displayWorking();$.getJSON("ajax.php?action=loadStation&station="+encodeURIComponent(a),function(b){"ok"===b.status?($("#musicwrapper").html(b.html),setRadioStationTitle(a)):"error"===b.status?alert(b.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(b);hideWorking()})}function setRadioStationTitle(a){var b=$("#radio-station-wrapper");b.html("<div class='album-title'>"+a.replace(/_/," ")+"</div>"+b.html())}
function setPlayerStationTitle(a){$("#content-player .album-title").first().html(a.replace(/_/," "))}function loadMyRadio(a,b){var c=$(b).data("station");location.hash="#/loadstation/"+c;displayWorking();$.getJSON("ajax.php?action=loadStation&station="+encodeURIComponent(c),function(a){"ok"===a.status?($("#musicwrapper").html(a.html),setRadioStationTitle(c)):"error"===a.status?alert(a.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(a);hideWorking()})}
function removeRadioStation(a,b){var c=a||window.event,d=$(b).data("station");displayWorking();$.getJSON("ajax.php?action=removeRadioStation&station="+encodeURIComponent(d),function(a){"ok"===a.status?$(b).parent().remove():"error"===a.status?alert(a.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(a);hideWorking()});c.stopPropagation();c.stopImmediatePropagation();c.cancelBubble=!0;return!1}
function getHashValue(a){console.log("action="+a);var b=window.location.hash,b=b.replace(/^#/,""),b=b.split("/");switch(b[1]){case a:return decodeURIComponent(b[2]);default:return!1}}function setControlsFixSize(){$("#musicwrapper").css("margin-top",32+$(".controls-wrapper").height()+"px");$(".controls-wrapper").css("width",$("#content").width()+"px")}isRadioMode=!1;
$(document).ready(function(){FastClick.attach(document.body);init();$(window).on("hashchange",function(){init()});$("#find-music-input").livequery(function(){$("#find-music-input").autocomplete({source:"ajax.php?action=suggest",minLength:2,delay:100,autoFocus:!1,html:!0,select:function(a,b){var c=b.item.dir;displayWorking();var d=getHashValue("loadstation");$.getJSON("ajax.php?action=addToRadioStation&dir="+encodeURIComponent(c)+"&station="+encodeURIComponent(d),function(a){"ok"===a.status?$("#radio-station-wrapper").prepend(a.html):
"error"===a.status?alert(a.message):alert("An unexpected error has occurred. Could not save radio.");handleLogoutJson(a);hideWorking()})}})});0<$("#content-player").length&&0<$(".m3uplayer").length&&$("#playbutton").html("Pause");$(document).on("click","#playbutton",function(){toggleMusicOn($(this).data("url"))});$(document).on("click",".jp-play",function(){$("#playbutton").html("Pause")});$(document).on("click",".jp-pause,.jp-stop",function(){$("#playbutton").html("Play")});$(document).on("click",
".droplink",function(){openDir($(this).data("url"))});$(document).on("click",".dirlink",function(){openDir($(this).data("url"))});$(document).on("click",".dirlinkcover",function(){openDir($(this).data("url"))});$(document).on("click",".addtoplaylist",function(a){addToPlaylist(a,this)});$(document).on("click",".jp-clear-playlist",function(a){clearPlaylist(a,this)});$(document).on("click","#logout-link",function(){logout(this)});$(document).on("click","#my-radio-button",function(){getHomeNavigation();
openMyRadio()});$(document).on("click","#play-my-radio",function(){var a=window.location.hash,a=a.replace(/^#/,""),a=a.split("/");switch(a[1]){case "myradio":playMyRadio(null);case "loadstation":a=decodeURIComponent(a[2]),playMyRadio(a),setPlayerStationTitle(a)}});$(document).on("click","#radio-button",function(a){playRadio(a)});$(document).on("click",".createradiobutton",function(a){createPersonalRadio(a,this)});$(document).on("click",".addtoradiobutton",function(a){addToPersonalRadio(a,this)});
$(document).on("click",".removefromradiobutton",function(a){removeFromPersonalRadio(a,this)});saveDialog=!1;$(document).on("click","#save-my-radio",function(){clickSaveMyRadio()});$(document).on("click","#save-radio-button",function(){saveMyRadio()});$(document).on("click","#view-my-radio-stations-button",function(){viewMyRadio()});$(document).on("click",".radio-station",function(a){loadMyRadio(a,this)});$(document).on("click",".radio-station-remove",function(a){if(!confirm("Are you sure you want to remove this station?"))return!1;
removeRadioStation(a,this)});prevtime=parseInt((new Date).getTime());curval="";t=null;$(document).on("keyup","#search",function(){var a=new StreamsConfig;curval=$(this).val();curtime=parseInt((new Date).getTime());next=prevtime+a.searchThreshold;prevtime=curtime;curtime<next&&(clearTimeout(t),t=setTimeout("search('"+curval+"')",a.searchThreshold))});$(".playlist-albumart").livequery(function(){var a=$(this);a.data("done")||$.getJSON("ajax.php?action=getAlbumArt&dir="+encodeURIComponent(a.data("dir"))+
"&file="+encodeURIComponent(a.data("file")),function(b){a.attr("src",b.albumart);a.data("done",!0).css("width","2em").css("height","2em")})});$(".jp-volume-bar").livequery(function(){$(".jp-volume-bar").on("click",function(){var a=parseInt($(".jp-volume-bar").css("width").replace(/px/,"")),a=parseInt($(".jp-volume-bar-value").css("width").replace(/px/,""))/a;$.getJSON("ajax.php?action=saveVolume&volume="+encodeURIComponent(a),function(){})})});$(".jp-volume-max").livequery(function(){$(".jp-volume-max").on("click",
function(){$.getJSON("ajax.php?action=saveVolume&volume="+encodeURIComponent(1),function(){})})});$(".jp-mute").livequery(function(){$(".jp-mute").on("click",function(){$.getJSON("ajax.php?action=saveVolume&volume="+encodeURIComponent(0),function(){})})});$(".jp-unmute").livequery(function(){$(".jp-unmute").on("click",function(){var a=parseInt($(".jp-volume-bar").css("width").replace(/px/,"")),a=parseInt($(".jp-volume-bar-value").css("width").replace(/px/,""))/a;$.getJSON("ajax.php?action=saveVolume&volume="+
encodeURIComponent(a),function(){})})});$("#play-my-radio, #save-my-radio, #view-my-radio-stations-button").livequery(function(){setControlsFixSize()});$("#musicwrapper").livequery(function(){setControlsFixSize()});$("#musicwrapper").livequery(function(){$(window).resize(function(){setControlsFixSize()})})});
